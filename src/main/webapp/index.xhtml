<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">
<h:head>
</h:head>
<h:body>

<h:outputScript library="default" name = "js/Chart.js" /> 

	<p:layout fullPage="true">
		<ui:remove>
			<p:layoutUnit position="north" size="100" header="Top"
				resizable="true" closable="true" collapsible="true">
				<h:outputText value="North unit content." />
			</p:layoutUnit>

			<p:layoutUnit position="south" size="100" header="Bottom"
				resizable="true" closable="true" collapsible="true">
			</p:layoutUnit>

			<p:layoutUnit position="west" size="200" header="Left"
				resizable="true" closable="true" collapsible="true">
			</p:layoutUnit>

			<p:layoutUnit position="east" size="40%" header="Right"
				style="height:100%;" resizable="true" closable="true"
				collapsible="true" effect="drop">
				<h:panelGroup layout="block" id="rawString">
					<h:form>
						<pe:codeMirror id="codeMirror" theme="cobalt" style="height:auto;"
							lineNumbers="true" value="#{apiBean.apiWrapper.rawString}"
							matchBrackets="true" />
					</h:form>
				</h:panelGroup>
			</p:layoutUnit>
			
			<p:poll interval="10" listener="#{apiBean.refresh}"
							update="graph rawString" />
		</ui:remove>

		<p:layoutUnit position="west" size="200" header="Configuration"
				resizable="true" closable="false" collapsible="true" collapsed="true" >
				
				<h:form>
					
					<h:outputText value="Auto Update: " />
					<p:inputSwitch value="#{apiBean.bDoUpdate}">
			            <p:ajax render=":#{p:component('graph')}" event="change"/>
			        </p:inputSwitch>			        
			        
					<h:outputText value="Refresh interval: " />
					<p:inputText id="inputRefreshInterval" value="#{apiBean.refreshInterval}" />
        			<p:slider for="inputRefreshInterval" minValue="5" step="1" >
        				<p:ajax render=":#{p:component('graph')}" event="slideEnd" listener="#{apiBean.onSlideEnd_RefreshInterval}"/>
        			</p:slider>
        			
				</h:form>
		</p:layoutUnit>

		<p:layoutUnit position="east" size="40%" header="Right"
			style="height:100%;" resizable="true" closable="false"
			collapsible="true" effect="drop">
			<h:panelGroup layout="block" id="rawString">
				<pre>#{apiBean.apiWrapper.rawString}</pre>
			</h:panelGroup>
		</p:layoutUnit>

		<p:layoutUnit position="center" header="Center">
				
			<h:form>	
				<p:growl id="growl" showDetail="true" sticky="false" /> 					
				<p:inputTextarea value="#{apiBean.strUrl}" style="width:100%;" rows="2" >
					<p:ajax update=":#{p:component('graph')} :#{p:component('rawString')} :#{p:component('growl')}" listener="#{apiBean.refresh}" />
				</p:inputTextarea>

				<h:panelGroup layout="block" id="graph">
					<p:poll interval="#{apiBean.refreshInterval}" listener="#{apiBean.refresh}"
						update="graph rawString growl" rendered="#{apiBean.bDoUpdate}"/>
				
					<div class="chart-container" style="position:relative; width:100%">
    					<canvas id="myChart"></canvas>
					</div>
					<h:outputScript library="default" name = "js/StockChart.js" /> 
					<h:form>
    					<p:commandLink action="#{lineChartBean.retrieveLineChartData}"
                   			oncomplete="drawLineChart(xhr,status,args);"
                   			value="Generate line chart" />
					</h:form>
				    
					<!-- <p:chart type="line" model="#{histChartBean.lineChart}"
						style="height:300px;" /> -->					

					<p:dataTable id="myTable" var="lineResult"
						value="#{apiBean.apiWrapper.rows}" paginatorAlwaysVisible="false"
						paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
						paginator="true" rows="30" rowKey="#{lineResult}" lazy="false" reflow="true">
						<p:columns value="#{apiBean.apiWrapper.headers}" var="column"
							columnIndexVar="i">
							<f:facet name="header">
								<h:outputText value="#{column}" />
							</f:facet>
							<h:outputText value="#{lineResult.get(column)}" />
						</p:columns>
					</p:dataTable>
				</h:panelGroup>
				
			</h:form>

		</p:layoutUnit>

	</p:layout>

</h:body>
</html>